# Nomos DAO Framework 仕様書

## 概要
Nomos DAO Frameworkは、Web2コミュニティ向けのモジュラー型DAOフレームワークです。Proof of Intentionalityとエンジン交換アーキテクチャを実装し、TikTokやYouTubeなどの様々なWeb2コミュニティに対応したDAO運営を可能にします。フレームワークは3層アーキテクチャ（Layer 1: エンジン層、Layer 2: エンジン出力層、Layer 3: ガバナンス・配布層）を採用しています。

## アーキテクチャ
フレームワークは3つの独立したリポジトリで構成されます：

### 1. nomos-core（バックエンド）
- Motokoで実装されたコアシステム
- Proof of Intentionalityメカニズムの実装
- モジュラーエンジン交換アーキテクチャ
- 3層アーキテクチャの実装（Layer 1-3）
- DAO基本データの永続化（DAO設定、メンバー情報、投票履歴）
- エンジン登録・管理機能
- 投票システムの基盤機能
- APIコネクタモジュール（エンジンが外部REST APIエンドポイントを登録可能）

#### Layer 2: エンジン出力層
- 標準化されたエンジン出力インターフェース
- 影響力スコア（influence score）の計算・管理
- 投票権重（voting power）の算出
- エンジン間での出力データ標準化
- Layer 3への標準化されたデータ提供

#### Layer 3: ガバナンス・配布層
- 報酬プール管理システム
- 自動報酬配布メカニズム
- Layer 2出力を活用した投票ガバナンスロジック
- 配布比率の計算・管理
- アクティブ投票の管理

### 2. nomos-engines（エンジンモジュール）
- 交換可能なDAOロジックモジュールのコレクション
- Web2プラットフォーム別の専用エンジン（TikTok、YouTube等）
- 各エンジンは独立したロジックとルールセットを提供
- 標準化されたAPIインターフェース
- Layer 2への標準化された出力提供

### 3. nomos-ui（フロントエンド）
- React + TypeScript + Tailwindで実装された独立フロントエンドリポジトリ
- 完全に独立したリポジトリ構造とセットアップ
- DAO可視化・管理インターフェース
- エンジン切り替え機能（GUI操作または投票による）
- 日本語対応のユーザーインターフェース
- APIコネクタ管理UI
- Layer 2・Layer 3メトリクス可視化ダッシュボード

## nomos-ui リポジトリ詳細

### リポジトリ目的とアーキテクチャ概要
nomos-uiは完全に独立したフロントエンド専用リポジトリです：
- フレームワーク全体のユーザーインターフェースを提供
- nomos-coreバックエンドとの通信を担当
- 独立した開発・デプロイメント・貢献体制
- モジュラーアーキテクチャによる拡張性
- 3層アーキテクチャの可視化機能

### 通信構造
nomos-uiとnomos-core間の通信：
- 専用APIクライアントレイヤーによる抽象化
- HTTPS呼び出しまたはローカルアイデンティティを通じた通信
- 標準化されたインターフェースによるバックエンド独立性
- エラーハンドリングと再試行機能
- Layer 2・Layer 3データの取得・表示機能

### テーマとデザインシステム自律性
独立したデザインシステム：
- Tailwind CSS + Shadcn/ui セットアップ
- カスタムカラーパレットとタイポグラフィ
- 日本語フォント最適化
- レスポンシブデザイントークン
- コンポーネントライブラリの独立管理

### セットアップと統合ワークフロー
開発者向けセットアップ手順：
- 独立したクローンとインストール手順
- 環境変数によるバックエンドキャニスター接続設定
- ローカル開発環境の構築
- バックエンドバインディングプロセス
- 詳細なREADME文書とセットアップガイド

## フロントエンド構造

### フォルダ構成
- `components/` — 再利用可能なUIコンポーネントとダイアログ
- `pages/` — ダッシュボード、コネクタ、DAO設定ページ
- `theme/` — Tailwindを使用したカラー、タイポグラフィ、レイアウトトークン
- `api/` — バックエンドとの通信レイヤー
- `docs/` — 貢献ガイドラインと開発文書

### API クライアントモジュール
- `api/nomos-core-client.ts` — nomos-coreバックエンドキャニスターとのインターフェース
- HTTPS呼び出しまたはローカルアイデンティティを通じた通信
- 既存機能（DAO管理、エンジン交換、APIコネクタ）の維持
- Layer 2・Layer 3データアクセス機能

### 独立実行対応
- 独立したセットアップ手順
- バックエンドキャニスターID用の環境変数設定
- README文書による実行方法の説明

## 主要機能

### DAO管理
- DAO作成・設定
- メンバー管理
- 投票システム
- アクティビティ履歴表示

### エンジン管理
- 利用可能エンジン一覧表示
- エンジン切り替え（管理者権限またはDAO投票）
- エンジン固有の設定管理

### Layer 2・Layer 3可視化
- Layer 2出力の表示（影響力スコア、投票権重）
- Layer 3メトリクスの表示（プールサイズ、配布比率、アクティブ投票）
- リアルタイムデータ更新
- 日本語でのメトリクス表示

### APIコネクタ管理
- エンジンごとの外部API接続設定
- OAuth2、APIキー認証対応
- トークン管理・更新機能
- TikTokコネクタテンプレート提供

### 投票システム
- エンジン変更提案・投票
- DAO運営に関する各種提案・投票
- 投票結果の自動反映
- Layer 2出力を活用した投票権重計算

## データ永続化
バックエンドで保存するデータ：
- DAO基本情報（名前、説明、設定）
- メンバーリストと権限
- 投票履歴と結果
- 現在アクティブなエンジン情報
- エンジン設定データ
- APIコネクタ情報（ID、エンジンID、ベースURL、認証タイプ、アクセストークン、設定）
- Layer 2出力データ（影響力スコア、投票権重）
- Layer 3データ（報酬プール、配布履歴、ガバナンス設定）

## Layer 2・Layer 3アーキテクチャ

### Layer 2: エンジン出力層
データ構造：
- 影響力スコア（各メンバーの活動に基づく数値）
- 投票権重（ガバナンス参加時の重み）
- エンジン固有メトリクス
- 標準化された出力フォーマット

主要操作：
- エンジン出力の標準化処理
- スコア計算・更新
- Layer 3への データ提供

### Layer 3: ガバナンス・配布層
データ構造：
- 報酬プール（総額、利用可能額）
- 配布比率（メンバー別配布割合）
- アクティブ投票（進行中の提案・投票）
- 配布履歴

主要操作：
- Layer 2出力を活用した報酬計算
- 自動配布実行
- ガバナンス投票管理
- プール管理

## APIコネクタ機能

### データ構造
APIコネクタは以下の情報を管理：
- ID（一意識別子）
- エンジンID（関連するエンジン）
- ベースURL（API接続先）
- 認証タイプ（OAuth2、APIキー等）
- アクセストークン（認証情報）
- 設定（カスタムJSONパラメータ）

### 主要操作
- APIコネクタ追加（管理者権限）
- エンジン別コネクタ取得
- 認証トークン更新

### TikTokコネクタテンプレート
事前定義されたTikTok API接続設定：
- ベースURL: https://open-api.tiktok.com/
- 認証タイプ: OAuth2
- スコープ例: user.info.basic, video.upload
- OAuth フロー説明とツールチップ

## フロントエンド機能

### Layer 2・Layer 3ダッシュボード
メインダッシュボードに追加される機能：
- Layer 2メトリクス表示（影響力スコア、投票権重の可視化）
- Layer 3メトリクス表示（プールサイズ、配布比率、アクティブ投票数）
- リアルタイムデータ更新
- 日本語でのラベル・説明表示
- グラフ・チャートによる視覚的表現

### APIコネクタマネージャー
エンジンマネージャー内の各エンジンに対して：
- 登録済みコネクタ一覧表示
- 新規コネクタ追加フォーム（ID、ベースURL、認証タイプ、設定）
- OAuth フロー用トークン管理
- TikTok コネクタテンプレート選択オプション

## API設計
- 各モジュール間の明確なAPI境界
- 標準化されたエンジンインターフェース
- RESTful APIパターンの採用
- 独立した開発・貢献を可能にする設計
- APIコネクタ管理用エンドポイント
- フロントエンドからバックエンドへの軽量APIクライアント
- Layer 2・Layer 3間の明確なデータフローインターフェース

## オープンソース対応とリンク

### リポジトリ管理
- GitHub上での独立リポジトリ管理
- 各モジュールの独立した貢献体制
- 明確なドキュメンテーション
- フロントエンドの独立実行環境

### nomos-ui 貢献ガイドライン
- 独立したコントリビューションワークフロー
- フロントエンド専用のイシュートラッキング
- UIコンポーネント開発ガイドライン
- デザインシステム貢献手順
- 日本語ローカライゼーション貢献方法
- コードレビュープロセス
- テスト要件とカバレッジ基準

### プロジェクト文書リンク
- メインプロジェクト文書内でのnomos-ui参照
- セットアップガイドへの直接リンク
- 貢献者向けドキュメントリンク
- API仕様書とインターフェース文書
- デザインシステムガイドライン
- Layer 2・Layer 3アーキテクチャ文書
